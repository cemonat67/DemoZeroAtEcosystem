<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rabateks DPP ‚Äì Random Order Creator</title>
  <meta name="description" content="Random Order Generation ‚Ä¢ Database Management ‚Ä¢ Production Testing">
  <style>
:root{
  --bg:#ffffff;
  --primary:#02154e;
  --accent:#f9ba00;
  --green:#005530;
  --red:#D51635;
  --navy:#02154e;
  --light:#f8f9fa;
  --muted:#6c757d;
  --border:#e9ecef;
  --shadow:rgba(0,0,0,0.1);
}
*{margin:0;padding:0;box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#1b2430}
.back-link{
  position:absolute;top:20px;right:20px;z-index:1000;
  background:var(--green);color:white;padding:12px 20px;border-radius:8px;
  text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(0,85,48,0.25);
  transition:all 0.3s ease;border:none;cursor:pointer;
}
.back-link:hover{ transform:translateY(-1px); box-shadow:0 4px 12px rgba(0,85,48,0.35); }
.back-link:active{ transform:translateY(0); }
.header{background:var(--bg);padding:25px 0;border-bottom:2px solid var(--border);text-align:center}
.header h1{color:var(--primary);font-size:28px;font-weight:700;margin-bottom:8px}
.header .subtitle{color:var(--muted);font-size:16px}
.container{max-width:1400px;margin:18px auto;padding:0 18px}
.btn{padding:12px 24px;border:1px solid var(--border);border-radius:8px;background:var(--bg);cursor:pointer;font-weight:600;transition:all 0.2s;text-decoration:none;display:inline-block;font-size:14px}
.btn.primary{background:var(--primary);color:white;border-color:var(--primary)}
.btn.primary:hover{background:#1a237e;box-shadow:0 4px 12px rgba(2,21,78,0.25)}
.btn.success{background:var(--green);color:white;border-color:var(--green)}
.btn.success:hover{background:#004225;box-shadow:0 4px 12px rgba(0,85,48,0.25)}
.btn.danger{background:var(--red);color:white;border-color:var(--red)}
.btn.danger:hover{background:#b01429;box-shadow:0 4px 12px rgba(213,22,53,0.3)}
.btn.accent{background:var(--accent);color:var(--primary);border-color:var(--accent)}
.btn.accent:hover{background:#e0a600;box-shadow:0 4px 12px rgba(249,186,0,0.3)}
.dashboard{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:32px}
.dashboard .metric{background:var(--bg);padding:20px;border-radius:12px;text-align:center;border:1px solid var(--border);box-shadow:0 2px 8px var(--shadow)}
.dashboard .metric-label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px}
.dashboard .metric-value{font-size:24px;font-weight:700;color:var(--primary)}
.creator-section{background:#f0f8f0;padding:30px;border-radius:16px;border:2px solid var(--green);margin-bottom:30px;text-align:center}
.creator-section h2{color:var(--green);font-size:24px;margin-bottom:15px}
.creator-section p{color:var(--muted);font-size:16px;margin-bottom:25px}
.creator-button{background:linear-gradient(135deg, var(--green) 0%, var(--primary) 100%);color:white;border:none;padding:18px 36px;border-radius:12px;font-size:18px;font-weight:700;cursor:pointer;transition:all 0.3s ease;box-shadow:0 4px 16px rgba(0,85,48,0.3)}
.creator-button:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,85,48,0.4)}
.creator-button:active{transform:translateY(0)}
.loading{display:none;margin-top:15px;color:var(--green);font-weight:600}
.table-container{background:var(--bg);border-radius:12px;overflow:hidden;border:1px solid var(--border);box-shadow:0 2px 8px var(--shadow)}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:12px 14px;text-align:left;border-bottom:1px solid var(--border);font-size:13px}
.table th{background:#f8fafc;font-weight:600;color:#374151;text-transform:uppercase;letter-spacing:0.5px}
.table tr:hover{background:#f8fafc}
.table tr:nth-child(even){background:#fafbfc}
.generation-log{background:#fff9e6;border:2px solid #f9ba00;border-radius:12px;padding:20px;margin-bottom:20px;max-height:200px;overflow-y:auto}
.generation-log h3{color:#d97706;margin-bottom:10px}
.log-entry{padding:4px 0;font-family:monospace;font-size:12px;color:#374151}
.actions-bar{display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;justify-content:space-between;align-items:center}
.stats-section{display:flex;gap:12px;align-items:center}
@media (max-width:1200px){.dashboard{grid-template-columns:repeat(3,1fr)}}
@media (max-width:768px){.dashboard{grid-template-columns:repeat(2,1fr)}.actions-bar{flex-direction:column;align-items:stretch}}
@media (max-width:480px){.dashboard{grid-template-columns:1fr}}
  </style>

<!-- ICON LIBRARIES -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
<!-- END ICON LIBRARIES -->

<style id="zplogo-style">
  .zplogo-wrap{position:absolute;left:24px;top:12px;z-index:10;pointer-events:none}
  .zplogo-wrap img{height:84px;width:auto;display:block}
  @media (max-width:768px){ .zplogo-wrap img{height:64px} }
</style>
<style id="fixed-header-140">
  .header, .main-header {
    height: 140px !important;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 0;
    margin: 0;
  }
  .header img, .main-header img {
    height: 84px !important;
    width: auto;
    margin-bottom: 8px;
  }
  .header h1, .main-header h1 {
    font-size: 2rem !important;
    margin: 4px 0;
  }
  .header p, .main-header p {
    font-size: 1.1rem !important;
    margin: 2px 0;
  }
</style>
</head>
<body>
<div class="zplogo-wrap"><img src="assets/img/zaplogo.svg" alt="Zero@Production"></div>

<a class="back-link" href="index.html" title="Back to Main Dashboard">‚Üê Back to Main Dashboard</a>

  <div class="header">
    <div style="display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:12px">
      <div style="width:48px;height:48px;background:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center">
        <span style="color:white;font-weight:bold;font-size:16px">R</span>
      </div>
      </div>
  </div>

  <div class="container">
    <!-- Dashboard Metrics -->
    <div class="dashboard">
      <div class="metric">
        <div class="metric-label">üìã Total Orders</div>
        <div class="metric-value" id="totalOrders">0</div>
      </div>
      <div class="metric">
        <div class="metric-label">üëï Total Quantity</div>
        <div class="metric-value" id="totalQuantity">0</div>
      </div>
      <div class="metric">
        <div class="metric-label">üé≤ Last Batch</div>
        <div class="metric-value" id="lastBatch">0</div>
      </div>
      <div class="metric">
        <div class="metric-label"><i class="ti ti-cloud-fog"></i> Countries</div>
        <div class="metric-value" id="uniqueCountries">0</div>
      </div>
      <div class="metric">
        <div class="metric-label"><i class="fa-solid fa-industry"></i> Product Types</div>
        <div class="metric-value" id="uniqueProducts">0</div>
      </div>
    </div>

    <!-- Random Order Creator -->
    <div class="creator-section">
      <h2>üé≤ Random Order Generator</h2>
      <p>Her tƒ±klamada 10 adet rastgele √ºretim sipari≈üi olu≈üturur ve veritabanƒ±na kaydeder</p>
      
      <button class="creator-button" onclick="createRandomOrders()" id="createBtn">
        üöÄ Create 10 Random Orders
      </button>
      
      <div class="loading" id="loadingIndicator">
        ‚è≥ Creating orders... Please wait...
      </div>
    </div>

    <!-- Generation Log -->
    <div class="generation-log" id="generationLog" style="display:none">
      <h3>üìù Generation Log</h3>
      <div id="logContent"></div>
    </div>

    <!-- Actions Bar -->
    <div class="actions-bar">
      <div class="stats-section">
        <span style="font-weight:600;color:var(--muted)">Database Operations:</span>
      </div>
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <button class="btn accent" onclick="pushOrdersToGarmentDPP()">üì§ Push Orders</button>
        <button class="btn success" onclick="openGarmentDPP()">üöÄ Open Garment DPP</button>
        <button class="btn primary" onclick="exportToCSV()"><i class="bi bi-diagram-3"></i> Export CSV</button>
        <button class="btn" onclick="viewStats()">üìà View Statistics</button>
        <button class="btn danger" onclick="clearDatabase()">üóëÔ∏è Clear Database</button>
      </div>
    </div>

    <!-- Orders Table -->
    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>#</th>
            <th>Country</th>
            <th>Facility</th>
            <th>PO No.</th>
            <th>Style Name</th>
            <th>Product Type</th>
            <th>Fabric Type</th>
            <th>Fabric Name</th>
            <th>Fabric Construction</th>
            <th>Weight (gsm)</th>
            <th>Quantity</th>
            <th>Created Date</th>
          </tr>
        </thead>
        <tbody id="ordersTableBody">
          <!-- Orders will be populated here -->
        </tbody>
      </table>
    </div>
  </div>

  <script>

    // === DATABASE ===
    let ordersDatabase = JSON.parse(localStorage.getItem('rabateks_orders_db') || '[]');
    let orderCounter = ordersDatabase.length;

    // === DATA POOLS ===
    const DATA_POOLS = {
      countries: [
        'T√ºrkiye', 'Germany', 'Netherlands', 'Spain', 'United Kingdom', 'Italy', 'Portugal'
      ],
      
      facilities: {
        'T√ºrkiye': ['Rabateks Main Factory', 'Rabateks Facility 2'],
        'Germany': ['Partner Factory A', 'Mango Apparel GmbH'],
        'Netherlands': ['Dutch Textile Works', 'Amsterdam Manufacturing'],
        'Spain': ['Iberian Garments', 'Barcelona Textiles'],
        'United Kingdom': ['British Manufacturing Ltd', 'London Apparel Co'],
        'Italy': ['Milano Fashion House', 'Italian Textile Group'],
        'Portugal': ['Porto Manufacturing', 'Lisbon Garments']
      },
      
      productTypes: {
        'Woven': [
          'Dress shirt', 'Casual shirt', 'Flannel shirt', 'Suit jacket', 'Trousers', 'Waistcoat', 'Blazer',
          'Trench coat', 'Bomber jacket', 'Safari jacket', 'Chinos', 'Dress pants', 'Cargo pants',
          'Pencil skirt', 'Pleated skirt', 'A-line skirt', 'Shift dress', 'Shirt dress', 'Wrap dress',
          'Blouse', 'Tunic', 'Peasant top', 'Tailored shorts', 'Bermuda shorts', 'Overcoat',
          'Pea coat', 'Duffle coat', 'Fedora hat', 'Bucket hat', 'Tote bag', 'Clutch bag',
          'Uniform shirt', 'Work trousers'
        ],
        'Circular Knit': [
          'Crew neck T-shirt', 'V-neck T-shirt', 'Polo shirt', 'Crewneck sweatshirt', 'Hoodie',
          'Quarter-zip sweatshirt', 'Jogger pants', 'Sweatpants', 'Tank top', 'Lightweight sweater',
          'Thermal underwear', 'Long johns', 'Knit pyjamas', 'Jersey sports top', 'Yoga top',
          'Knit dress', 'Bodycon dress', 'Jersey shorts', 'Jersey skirt'
        ],
        'Flatknit': [
          'Crew neck sweater', 'V-neck sweater', 'Turtleneck sweater', 'Button-up cardigan',
          'Open-front cardigan', 'Poncho', 'Vest', 'Sleeveless pullover', 'Knitted shawl',
          'Knitted scarf', 'Knitted beanie', 'Knitted cap', 'Knitted gloves', 'Knitted dress',
          'Knitted baby romper', 'Knitted waistcoat'
        ],
        'Nonwoven': [
          'Medical gown', 'Surgical mask', 'Surgical cap', 'Disposable coverall', 'Disposable tablecloth',
          'Non-woven shopper bag', 'Sanitary pad top layer', 'Baby diaper top layer', 'Cleaning cloth',
          'Non-woven filter', 'Non-woven glove lining', 'Disposable hotel slippers', 'Gift wrap', 'Garment bag'
        ],
        'Denim': [
          'Slim jeans', 'Straight jeans', 'Bootcut jeans', 'Flare jeans', 'Boyfriend jeans', 'Skinny jeans',
          'Trucker denim jacket', 'Oversized denim jacket', 'Western denim shirt', 'Mini denim skirt',
          'Midi denim skirt', 'Maxi denim skirt', 'Denim overall', 'Denim pinafore dress',
          'Cut-off denim shorts', 'Bermuda denim shorts', 'Denim tote bag', 'Denim backpack',
          'Denim bucket hat', 'Denim cap', 'Denim work overalls', 'Denim vest'
        ]
      },

      fabricTypes: {
        'Woven': 'Woven',
        'Circular Knit': 'Circular Knit', 
        'Flatknit': 'Flatknit',
        'Nonwoven': 'Nonwoven',
        'Denim': 'Denim'
      },

      fabricNames: [
        'Single Jersey', 'Pique Knit', 'Fleece', 'French Terry', 'Rib Knit',
        'Twill', 'Canvas', 'Poplin', 'Oxford', 'Chambray',
        'Denim', 'Corduroy', 'Velvet', 'Satin', 'Chiffon'
      ],

      fabricConstructions: {
        'Woven': [
          'Plain Weave / Poplin', 'Oxford', 'Chambray', 'Canvas', 'Twill', 'Denim', 'Satin', 'Sateen',
          'Herringbone', 'Dobby', 'Seersucker', 'Jacquard Woven', 'Corduroy', 'Ripstop'
        ],
        'Circular Knit': [
          'Single Jersey', 'Double Jersey', 'Interlock', 'Rib 1x1', 'Rib 2x2', 'Ottoman', 'Waffle Knit',
          'French Terry', 'Terry', 'Fleece Knit', 'Pique Knit', 'Jacquard Knit', 'Mesh Knit', 'Ponte Roma', 'Milano Rib'
        ],
        'Flatknit': [
          'Single Jersey', 'Double Jersey', 'Interlock', 'Rib 1x1', 'Rib 2x2', 'Ottoman', 'Waffle Knit',
          'French Terry', 'Terry', 'Fleece Knit', 'Pique Knit', 'Jacquard Knit', 'Mesh Knit', 'Ponte Roma', 'Milano Rib'
        ],
        'Nonwoven': [
          'Nonwoven Spunbond', 'Nonwoven Meltblown'
        ],
        'Denim': [
          'Denim'
        ]
      },

      productionSteps: [
        'Pattern Making', 'Cutting', 'Sewing', 'Embroidery', 'Printing',
        'Dyeing', 'Washing', 'Stone Washing', 'Pressing', 'Ironing',
        'Finishing', 'Quality Control', 'Packing', 'Labeling', 'Inspection'
      ],

      stylesPrefixes: [
        'NOVA', 'ALTA', 'METRO', 'URBAN', 'CLASSIC', 'ELITE', 'PRIME',
        'ROYAL', 'SIGMA', 'APEX', 'TITAN', 'SWIFT', 'BOLD', 'PURE'
      ],

      stylesSuffixes: [
        'PRO', 'TSH', 'JNS', 'HDD', 'BLZ', 'PLO', 'DLX', 'MAX',
        'ECO', 'LUX', 'FIT', 'SLIM', 'WIDE', 'SOFT', 'FLEX'
      ]
    };

    // === UTILITY FUNCTIONS ===
    function randomChoice(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    function randomNumber(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function generatePONumber() {
      return `PO-${randomNumber(10000, 99999)}`;
    }

    function generateStyleName() {
      const prefix = randomChoice(DATA_POOLS.stylesPrefixes);
      const suffix = randomChoice(DATA_POOLS.stylesSuffixes);
      return `${prefix}-${suffix}`;
    }

    function generateFabricName() {
      return `RD${randomNumber(1000, 9999)}`;
    }

    function generateRandomDate() {
      const start = new Date(2023, 0, 1);
      const end = new Date(2024, 11, 31);
      const randomTime = start.getTime() + Math.random() * (end.getTime() - start.getTime());
      return new Date(randomTime).toISOString().split('T')[0];
    }

    function generateFabricWeight(fabricType) {
      const weights = {
        'Woven': [120, 140, 160, 180, 200, 220],
        'Circular Knit': [140, 160, 180, 200, 220, 240],
        'Flatknit': [180, 200, 220, 240, 260, 280],
        'Nonwoven': [80, 100, 120, 140, 160],
        'Denim': [300, 350, 400, 450, 500],
        'default': [160, 180, 200, 220, 240]
      };
      
      const weightOptions = weights[fabricType] || weights.default;
      return randomChoice(weightOptions);
    }

    function generateQuantity() {
      return randomNumber(400, 25000);
    }

    function generateProductionSteps() {
      const stepCount = randomNumber(3, 7);
      const shuffled = [...DATA_POOLS.productionSteps].sort(() => 0.5 - Math.random());
      return shuffled.slice(0, stepCount);
    }

    // === ORDER CREATION ===
    function createSingleRandomOrder() {
      const country = randomChoice(DATA_POOLS.countries);
      const facility = randomChoice(DATA_POOLS.facilities[country]);
      
      // First select fabric type category
      const fabricTypeCategories = Object.keys(DATA_POOLS.productTypes);
      const selectedFabricTypeCategory = randomChoice(fabricTypeCategories);
      
      // Select product type based on fabric type category
      const productType = randomChoice(DATA_POOLS.productTypes[selectedFabricTypeCategory]);
      
      // Map fabric type category to actual fabric type
      let fabricType;
      if (selectedFabricTypeCategory === 'Circular Knit' || selectedFabricTypeCategory === 'Flatknit') {
        fabricType = 'Knit';
      } else {
        fabricType = selectedFabricTypeCategory;
      }
      
      // Generate fabric name with RD prefix
      const fabricName = generateFabricName();
      
      // Select fabric construction based on fabric type category
      const fabricConstruction = randomChoice(DATA_POOLS.fabricConstructions[selectedFabricTypeCategory]);
      const fabricWeight = generateFabricWeight(fabricType);
      const quantity = generateQuantity();
      const productionSteps = generateProductionSteps();

      const order = {
        id: ++orderCounter,
        country: country,
        facility: facility,
        poNumber: generatePONumber(),
        styleName: generateStyleName(),
        productType: productType,
        fabricType: fabricType,
        fabricName: fabricName,
        fabricConstruction: fabricConstruction,
        fabricWeight: fabricWeight,
        quantity: quantity,
        productionSteps: productionSteps,
        createdAt: new Date().toISOString(),
        createdTime: new Date().toLocaleString('tr-TR'),
        createdDate: generateRandomDate()
      };

      return order;
    }

    function createRandomOrders() {
      const createBtn = document.getElementById('createBtn');
      const loadingIndicator = document.getElementById('loadingIndicator');
      const logDiv = document.getElementById('generationLog');
      const logContent = document.getElementById('logContent');

      // Show loading
      createBtn.disabled = true;
      loadingIndicator.style.display = 'block';
      logDiv.style.display = 'block';
      logContent.innerHTML = '';

      // Log start
      logContent.innerHTML += `<div class="log-entry">üöÄ Starting generation of 10 random orders...</div>`;

      // Create orders with delay for visual effect
      let createdCount = 0;
      const batchStartTime = Date.now();

      const createOrderInterval = setInterval(() => {
        const order = createSingleRandomOrder();
        ordersDatabase.unshift(order); // Add to beginning
        createdCount++;

        // Log each order
        logContent.innerHTML += `<div class="log-entry">${createdCount}/10: ${order.styleName} - ${order.country} - ${order.quantity} pcs</div>`;
        logContent.scrollTop = logContent.scrollHeight;

        if (createdCount >= 10) {
          clearInterval(createOrderInterval);
          
          // Save to database
          saveDatabase();
          
          // AUTO-POPULATE GARMENT DPP
          transferToGarmentDPP();
          
          // Final log
          const duration = ((Date.now() - batchStartTime) / 1000).toFixed(1);
          logContent.innerHTML += `<div class="log-entry">‚úÖ Successfully created 10 orders in ${duration}s</div>`;
          logContent.innerHTML += `<div class="log-entry">üíæ Orders saved to database</div>`;
          logContent.innerHTML += `<div class="log-entry">üîÑ Data transferred to Garment DPP</div>`;

          // Update UI
          updateMetrics();
          renderOrdersTable();

          // Reset button
          createBtn.disabled = false;
          loadingIndicator.style.display = 'none';

          // Auto-hide log after 3 seconds
          setTimeout(() => {
            logDiv.style.display = 'none';
          }, 3000);
        }
      }, 200); // 200ms delay between each order
    }

    // === AUTO-POPULATE GARMENT DPP ===
    function transferToGarmentDPP() {
      // Get latest 10 orders (the ones just created)
      const latestOrders = ordersDatabase.slice(0, 10);
      
      // Convert to Garment DPP format
      const garmentOrders = latestOrders.map(order => ({
        id: crypto.randomUUID(),
        country: order.country,
        po: order.poNumber,
        style: order.styleName,
        productType: order.productType,
        fabricType: order.fabricType,
        fabricName: order.fabricName,
        fabricCode: generateGarmentFabricCode(order.fabricType, order.fabricWeight),
        fabricConstruction: order.fabricConstruction,
        fabricWeight: order.fabricWeight,
        qty: order.quantity,
        steps: order.productionSteps,
        co2: calculateCO2(order.productType, order.fabricType, order.fabricWeight, order.quantity)
      }));

      // Save to shared storage for Garment DPP
      localStorage.setItem('garment_dpp_import_data', JSON.stringify(garmentOrders));
      localStorage.setItem('garment_dpp_import_timestamp', Date.now().toString());
      
      console.log('üîÑ Data prepared for Garment DPP transfer:', garmentOrders.length, 'orders');
    }

    function generateGarmentFabricCode(fabricType, weight) {
      const prefixes = { 
        'Cotton': 'CT', 'Knit': 'KN', 'Woven': 'WV', 'Denim': 'DN', 
        'Polyester': 'PL', 'Wool': 'WL', 'Linen': 'LN', 'Silk': 'SK', 
        'Spandex': 'SP', 'Rayon': 'RY' 
      };
      const prefix = prefixes[fabricType] || 'XX';
      const suffix = Math.random().toString(36).substr(2, 2).toUpperCase();
      return `${suffix}-${weight}-${prefix}`;
    }

    function calculateCO2(productType, fabricType, weight, quantity) {
      // CO2 calculation based on Garment DPP logic
      const FABRIC_EF = {
        'Cotton': 5.9, 'Knit': 4.3, 'Woven': 3.8, 'Denim': 7.2, 'Polyester': 9.5,
        'Wool': 10.4, 'Linen': 1.8, 'Silk': 11.5, 'Spandex': 8.9, 'Rayon': 6.7
      };
      
      const productAreas = {
        'T-shirt': 0.8, 'Polo shirt': 0.9, 'Dress shirt': 1.0, 'Hoodie': 1.2, 'Tank top': 0.6,
        'Slim jeans': 1.1, 'Regular jeans': 1.2, 'Shorts': 0.7, 'Chinos': 1.0,
        'Blazer': 1.5, 'Jacket': 1.8, 'Sweatshirt': 1.1
      };
      
      const area = productAreas[productType] || 1.0;
      const massPerPieceKg = (weight * area) / 1000;
      const ef = FABRIC_EF[fabricType] || 6.0;
      const co2PerPiece = massPerPieceKg * ef;
      
      return (co2PerPiece * quantity).toFixed(2);
    }

    // === PUSH ORDERS TO GARMENT DPP ===
    function pushOrdersToGarmentDPP() {
      if (ordersDatabase.length === 0) {
        alert('üì≠ No orders to push!\n\nCreate some orders first by clicking "Create 10 Random Orders".');
        return;
      }

      const logDiv = document.getElementById('generationLog');
      const logContent = document.getElementById('logContent');

      // Show log
      logDiv.style.display = 'block';
      logContent.innerHTML = '';
      logContent.innerHTML += `<div class="log-entry">üì§ Pushing ${ordersDatabase.length} orders to Garment DPP...</div>`;

      // Convert all orders to Garment DPP format
      const garmentOrders = ordersDatabase.map(order => ({
        id: crypto.randomUUID(),
        country: order.country,
        po: order.poNumber,
        style: order.styleName,
        productType: order.productType,
        fabricType: order.fabricType,
        fabricName: order.fabricName,
        fabricCode: generateGarmentFabricCode(order.fabricType, order.fabricWeight),
        fabricConstruction: order.fabricConstruction,
        fabricWeight: order.fabricWeight,
        qty: order.quantity,
        steps: order.productionSteps,
        co2: calculateCO2(order.productType, order.fabricType, order.fabricWeight, order.quantity)
      }));

      // Save to shared storage for Garment DPP
      localStorage.setItem('garment_dpp_import_data', JSON.stringify(garmentOrders));
      localStorage.setItem('garment_dpp_import_timestamp', Date.now().toString());

      logContent.innerHTML += `<div class="log-entry">‚úÖ Successfully pushed ${garmentOrders.length} orders</div>`;
      logContent.innerHTML += `<div class="log-entry">üéØ Ready for import in Garment DPP</div>`;

      console.log('üì§ Data pushed to Garment DPP:', garmentOrders.length, 'orders');

      // Auto-hide log after 2 seconds
      setTimeout(() => {
        logDiv.style.display = 'none';
      }, 2000);
    }

    // === NAVIGATION TO GARMENT DPP ===
    function openGarmentDPP() {
      // Open Garment DPP in same tab
      window.location.href = 'GarmentDPP.html';
    }

    // === DATABASE OPERATIONS ===
    function saveDatabase() {
      localStorage.setItem('rabateks_orders_db', JSON.stringify(ordersDatabase));
    }

    function clearDatabase() {
      if (confirm('üóëÔ∏è Are you sure you want to clear all orders from database?\n\nThis action cannot be undone!')) {
        ordersDatabase = [];
        orderCounter = 0;
        saveDatabase();
        updateMetrics();
        renderOrdersTable();
        
        // Show log
        const logDiv = document.getElementById('generationLog');
        const logContent = document.getElementById('logContent');
        logDiv.style.display = 'block';
        logContent.innerHTML = '<div class="log-entry">üóëÔ∏è Database cleared successfully</div>';
        
        setTimeout(() => {
          logDiv.style.display = 'none';
        }, 2000);
      }
    }

    // === UI UPDATES ===
    function updateMetrics() {
      const totalOrders = ordersDatabase.length;
      const totalQuantity = ordersDatabase.reduce((sum, order) => sum + order.quantity, 0);
      const uniqueCountries = new Set(ordersDatabase.map(order => order.country)).size;
      const uniqueProducts = new Set(ordersDatabase.map(order => order.productType)).size;

      document.getElementById('totalOrders').textContent = totalOrders.toLocaleString();
      document.getElementById('totalQuantity').textContent = totalQuantity.toLocaleString();
      document.getElementById('lastBatch').textContent = '10';
      document.getElementById('uniqueCountries').textContent = uniqueCountries;
      document.getElementById('uniqueProducts').textContent = uniqueProducts;
    }

    function renderOrdersTable() {
      const tbody = document.getElementById('ordersTableBody');
      
      if (ordersDatabase.length === 0) {
        tbody.innerHTML = '<tr><td colspan="12" style="text-align:center;padding:40px;color:var(--muted)">No orders created yet. Click "Create 10 Random Orders" to get started!</td></tr>';
        return;
      }

      tbody.innerHTML = ordersDatabase.map((order, index) => `
        <tr>
          <td style="font-weight:600">${index + 1}</td>
          <td>${order.country}</td>
          <td style="color:var(--green);font-weight:600">${order.facility}</td>
          <td style="font-family:monospace">${order.poNumber}</td>
          <td style="font-weight:600;color:var(--primary)">${order.styleName}</td>
          <td>${order.productType}</td>
          <td>${order.fabricType}</td>
          <td style="font-family:monospace;color:var(--green)">${order.fabricName}</td>
          <td>${order.fabricConstruction}</td>
          <td style="text-align:center">${order.fabricWeight}</td>
          <td style="text-align:right;font-weight:600">${order.quantity.toLocaleString()}</td>
          <td style="font-size:11px;color:var(--muted)">${order.createdDate}</td>
        </tr>
      `).join('');
    }

    // === EXPORT FUNCTIONS ===
    function exportToCSV() {
      if (ordersDatabase.length === 0) {
        alert('No orders to export!');
        return;
      }

      const headers = [
        'ID', 'Country', 'Facility', 'PO Number', 'Style Name', 'Product Type', 
        'Fabric Type', 'Fabric Name', 'Fabric Construction', 'Fabric Weight (gsm)', 
        'Quantity', 'Created Date'
      ];

      const csvContent = [
        headers.join(','),
        ...ordersDatabase.map(order => [
          order.id,
          `"${order.country}"`,
          `"${order.facility}"`,
          `"${order.poNumber}"`,
          `"${order.styleName}"`,
          `"${order.productType}"`,
          `"${order.fabricType}"`,
          `"${order.fabricName}"`,
          `"${order.fabricConstruction}"`,
          order.fabricWeight,
          order.quantity,
          `"${order.createdDate}"`
        ].join(','))
      ].join('\n');

      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `rabateks-orders-${new Date().toISOString().slice(0,10)}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function viewStats() {
      if (ordersDatabase.length === 0) {
        alert('No orders in database for statistics!');
        return;
      }

      const stats = {
        totalOrders: ordersDatabase.length,
        totalQuantity: ordersDatabase.reduce((sum, order) => sum + order.quantity, 0),
        avgQuantity: Math.round(ordersDatabase.reduce((sum, order) => sum + order.quantity, 0) / ordersDatabase.length),
        countriesCount: new Set(ordersDatabase.map(order => order.country)).size,
        productsCount: new Set(ordersDatabase.map(order => order.productType)).size,
        fabricsCount: new Set(ordersDatabase.map(order => order.fabricType)).size,
        avgWeight: Math.round(ordersDatabase.reduce((sum, order) => sum + order.fabricWeight, 0) / ordersDatabase.length)
      };

      const message = `<i class="bi bi-diagram-3"></i> DATABASE STATISTICS\n\n` +
        `Total Orders: ${stats.totalOrders.toLocaleString()}\n` +
        `Total Quantity: ${stats.totalQuantity.toLocaleString()} pieces\n` +
        `Average Quantity: ${stats.avgQuantity.toLocaleString()} pieces/order\n` +
        `Unique Countries: ${stats.countriesCount}\n` +
        `Unique Product Types: ${stats.productsCount}\n` +
        `Unique Fabric Types: ${stats.fabricsCount}\n` +
        `Average Fabric Weight: ${stats.avgWeight} gsm`;

      alert(message);
    }

    // === INITIALIZATION ===
    document.addEventListener('DOMContentLoaded', () => {
      updateMetrics();
      renderOrdersTable();
      
      console.log('üé≤ Rabateks Random Order Creator loaded successfully!');
      console.log(`<i class="bi bi-diagram-3"></i> Database contains ${ordersDatabase.length} orders`);
    });

    // === KEYBOARD SHORTCUTS ===
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 'Enter':
            e.preventDefault();
            createRandomOrders();
            break;
          case 'e':
            e.preventDefault();
            exportToCSV();
            break;
          case 's':
            e.preventDefault();
            viewStats();
            break;
        }
      }
    });
  </script>
</body>
</html>