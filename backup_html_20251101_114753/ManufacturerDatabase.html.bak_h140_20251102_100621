<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rabateks DPP ‚Äî Manufacturer Database</title>
  <meta name="description" content="Manufacturer Database Management ‚Ä¢ Facility Information ‚Ä¢ Production Capacity">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
:root{
  --bg:#ffffff;
  --primary:#02154e;
  --accent:#f9ba00;
  --green:#005530;
  --red:#D51635;
  --navy:#02154e;
  --light:#f8f9fa;
  --muted:#6c757d;
  --border:#e9ecef;
  --shadow:rgba(0,0,0,0.1);
  --card:#ffffff;
}
*{margin:0;padding:0;box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#1b2430}
.back-link{
  position:absolute;top:20px;right:20px;z-index:1000;
  background:var(--green);color:white;padding:12px 20px;border-radius:8px;
  text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(0,85,48,0.25);
  transition:all 0.3s ease;border:none;cursor:pointer;
}
.back-link:hover{ transform:translateY(-1px); box-shadow:0 4px 12px rgba(0,85,48,0.35); }
.back-link:active{ transform:translateY(0); }
.header{background:var(--bg);padding:25px 0;border-bottom:2px solid var(--border);text-align:center}
.header h1{color:var(--primary);font-size:28px;font-weight:700;margin-bottom:8px}
.header .subtitle{color:var(--muted);font-size:16px}
.container{max-width:1400px;margin:18px auto;padding:0 18px}
.btn{padding:12px 24px;border:1px solid var(--border);border-radius:8px;background:var(--bg);cursor:pointer;font-weight:600;transition:all 0.2s;text-decoration:none;display:inline-block;font-size:14px}
.btn.primary{background:var(--primary);color:white;border-color:var(--primary)}
.btn.primary:hover{background:#1a237e;box-shadow:0 4px 12px rgba(2,21,78,0.25)}
.btn.success{background:var(--green);color:white;border-color:var(--green)}
.btn.success:hover{background:#004225;box-shadow:0 4px 12px rgba(0,85,48,0.25)}
.btn.danger{background:var(--red);color:white;border-color:var(--red)}
.btn.danger:hover{background:#b01429;box-shadow:0 4px 12px rgba(213,22,53,0.3)}
.form-section{background:var(--card);border-radius:12px;padding:24px;margin-bottom:24px;border:1px solid var(--border);box-shadow:0 2px 8px var(--shadow)}
.form-row{display:flex;gap:16px;margin-bottom:16px;flex-wrap:wrap}
.field{flex:1;min-width:200px}
.field label{display:block;margin-bottom:6px;font-weight:600;color:var(--primary)}
.field input,.field select,.field textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:6px;font-size:14px}
.field textarea{min-height:80px;resize:vertical}
.table-container{background:var(--card);border-radius:12px;overflow:hidden;border:1px solid var(--border);box-shadow:0 2px 8px var(--shadow)}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:12px 14px;text-align:left;border-bottom:1px solid var(--border);font-size:13px}
.table th{background:#f8fafc;font-weight:600;color:#374151;text-transform:uppercase;letter-spacing:0.5px}
.table tr:hover{background:#f8fafc}
.table tr:nth-child(even){background:#fafbfc}
.actions-bar{display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;justify-content:space-between;align-items:center}
.dashboard{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:32px}
.dashboard .metric{background:var(--card);padding:20px;border-radius:12px;text-align:center;border:1px solid var(--border);box-shadow:0 2px 8px var(--shadow)}
.dashboard .metric-label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px}
.dashboard .metric-value{font-size:24px;font-weight:700;color:var(--primary)}
.import-section{background:#fff9e6;border:2px solid #f9ba00;border-radius:12px;padding:20px;margin-bottom:20px}
.import-section h3{color:#d97706;margin-bottom:10px}
.status-indicator{padding:4px 8px;border-radius:4px;font-size:11px;font-weight:600}
.status-active{background:#d4edda;color:#155724}
.status-inactive{background:#f8d7da;color:#721c24}
.status-review{background:#fff3cd;color:#856404}
@media (max-width:1200px){.dashboard{grid-template-columns:repeat(3,1fr)}}
@media (max-width:768px){.dashboard{grid-template-columns:repeat(2,1fr)}.actions-bar{flex-direction:column;align-items:stretch}}
@media (max-width:480px){.dashboard{grid-template-columns:1fr}}
  </style>

<!-- ICON LIBRARIES -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
<!-- END ICON LIBRARIES -->

<style id="fixed-header-140">
  .header, .main-header {
    height: 140px !important;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 0;
    margin: 0;
  }
  .header img, .main-header img {
    height: 84px !important;
    width: auto;
    margin-bottom: 8px;
  }
  .header h1, .main-header h1 {
    font-size: 2rem !important;
    margin: 4px 0;
  }
  .header p, .main-header p {
    font-size: 1.1rem !important;
    margin: 2px 0;
  }
</style>
</head>
<body>
<div id="brand-logo" style="position:absolute;left:24px;top:12px;z-index:9999;"><img src="../assets/img/zaplogo.svg?v=4" alt="Zero@Production" style="height:84px;width:auto;"></div>

<a class="back-link" href="index.html" title="Back to Main Dashboard">‚Üê Back to Main Dashboard</a>

  <div class="header">
    <div style="display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:12px">
      <div style="width:48px;height:48px;background:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center">
        <span style="color:white;font-weight:bold;font-size:16px">M</span>
      </div>
      <div>
        <div id="zpp-head" style="text-align:center;margin:10px 0 12px 0;"><h1 style="margin:0 0 6px 0;font-weight:700;"><span style="color:#00062e">Zero</span><span class="dpp-title" style="color:#f9ba00">@</span><span style="color:#00062e">Production</span> <span class="dpp-title" style="color:#f9ba00">DPP</span> <span style="color:#00062e">Dashboard</span></h1><p class="subtitle" style="margin:4px 0 0 0;font-weight:600;color:#02154e;">Digital Product Passport ‚Ä¢ Energy Monitoring ‚Ä¢ Water Management ‚Ä¢ Utility Optimization</p></div>
        <p class="subtitle">Manufacturer Database Management ‚Ä¢ Facility Information ‚Ä¢ Production Capacity</p>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Import Section -->
    <div class="import-section">
      <h3>üìÅ Import from MangoApparelFacilities.xlsx</h3>
      <p>Import manufacturer data directly from Excel file:</p>
      <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" style="margin:10px 0">
      <button class="btn primary" onclick="importExcelFile()">Import Excel File</button>
      <button class="btn success" onclick="loadMangoData()">Load Mango Apparel Data</button>
      <div id="importStatus" style="margin-top:10px;font-weight:600;"></div>
    </div>

    <!-- Dashboard Metrics -->
    <div class="dashboard">
      <div class="metric">
        <div class="metric-label"><i class="fa-solid fa-industry"></i> Total Manufacturers</div>
        <div class="metric-value" id="totalManufacturers">0</div>
      </div>
      <div class="metric">
        <div class="metric-label"><i class="ti ti-cloud-fog"></i> Countries</div>
        <div class="metric-value" id="totalCountries">0</div>
      </div>
      <div class="metric">
        <div class="metric-label">üèóÔ∏è Total Capacity</div>
        <div class="metric-value" id="totalCapacity">0</div>
      </div>
      <div class="metric">
        <div class="metric-label">‚úÖ Active Facilities</div>
        <div class="metric-value" id="activeFacilities">0</div>
      </div>
    </div>

    <!-- Add/Edit Form -->
    <div class="form-section">
      <h3>Add New Manufacturer</h3>
      <div class="form-row">
        <div class="field">
          <label>Manufacturer Name</label>
          <input type="text" id="manufacturerName" placeholder="e.g., Mango Apparel">
        </div>
        <div class="field">
          <label>Facility Code</label>
          <input type="text" id="facilityCode" placeholder="e.g., MNG-001">
        </div>
        <div class="field">
          <label>Country</label>
          <select id="country">
            <option>T√ºrkiye</option><option>Germany</option><option>Netherlands</option>
            <option>Spain</option><option>United Kingdom</option><option>Italy</option><option>Portugal</option>
            <option>China</option><option>Bangladesh</option><option>Vietnam</option><option>India</option>
            <option>Morocco</option><option>Tunisia</option><option>Romania</option><option>Bulgaria</option>
          </select>
        </div>
        <div class="field">
          <label>City</label>
          <input type="text" id="city" placeholder="e.g., Barcelona">
        </div>
      </div>
      <div class="form-row">
        <div class="field">
          <label>Production Capacity (pcs/month)</label>
          <input type="number" id="capacity" placeholder="e.g., 50000">
        </div>
        <div class="field">
          <label>Specialization</label>
          <select id="specialization">
            <option>Woven Garments</option><option>Knit Garments</option><option>Denim</option>
            <option>Outerwear</option><option>Underwear</option><option>Sportswear</option>
            <option>Formal Wear</option><option>Casual Wear</option><option>Fast Fashion</option>
            <option>Sustainable Fashion</option><option>Luxury Apparel</option>
          </select>
        </div>
        <div class="field">
          <label>Status</label>
          <select id="status">
            <option>Active</option><option>Inactive</option><option>Under Review</option>
          </select>
        </div>
        <div class="field">
          <label>Contact Email</label>
          <input type="email" id="email" placeholder="e.g., contact@manufacturer.com">
        </div>
      </div>
      <div class="form-row">
        <div class="field">
          <label>Address</label>
          <textarea id="address" placeholder="Full address of the facility"></textarea>
        </div>
        <div class="field">
          <label>Certifications</label>
          <textarea id="certifications" placeholder="e.g., OEKO-TEX, GOTS, ISO 9001"></textarea>
        </div>
      </div>
      <div class="actions-bar">
        <button class="btn success" onclick="addManufacturer()">Add Manufacturer</button>
        <button class="btn" onclick="clearForm()">Clear Form</button>
        <button class="btn primary" onclick="exportCSV()">Export CSV</button>
        <button class="btn danger" onclick="clearDatabase()">Clear Database</button>
      </div>
    </div>

    <!-- Manufacturers Table -->
    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>#</th>
            <th>Manufacturer Name</th>
            <th>Facility Code</th>
            <th>Country</th>
            <th>City</th>
            <th>Capacity</th>
            <th>Specialization</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="manufacturersTableBody">
          <!-- Manufacturers will be populated here -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // Database
    let manufacturersDatabase = [];

    // Mango Apparel Facilities Data (from MangoApparelFacilities.xlsx)
    const mangoApparelData = [
      {
        id: 1,
        manufacturerName: 'Mango Apparel Barcelona',
        facilityCode: 'MNG-BCN-001',
        country: 'Spain',
        city: 'Barcelona',
        capacity: 120000,
        specialization: 'Fast Fashion',
        status: 'Active',
        email: 'barcelona@mangoapparelgroup.com',
        address: 'Palau-solit√† i Plegamans, Barcelona, Spain',
        certifications: 'OEKO-TEX, GOTS, ISO 9001, SA8000'
      },
      {
        id: 2,
        manufacturerName: 'Mango Apparel Turkey',
        facilityCode: 'MNG-IST-001',
        country: 'T√ºrkiye',
        city: 'Istanbul',
        capacity: 95000,
        specialization: 'Knit Garments',
        status: 'Active',
        email: 'istanbul@mangoapparelgroup.com',
        address: 'Beylikd√ºz√º, Istanbul, Turkey',
        certifications: 'OEKO-TEX, ISO 14001, WRAP'
      },
      {
        id: 3,
        manufacturerName: 'Mango Apparel Morocco',
        facilityCode: 'MNG-CAS-001',
        country: 'Morocco',
        city: 'Casablanca',
        capacity: 75000,
        specialization: 'Woven Garments',
        status: 'Active',
        email: 'casablanca@mangoapparelgroup.com',
        address: 'Ain Sebaa, Casablanca, Morocco',
        certifications: 'OEKO-TEX, ISO 9001'
      },
      {
        id: 4,
        manufacturerName: 'Mango Apparel Romania',
        facilityCode: 'MNG-BUC-001',
        country: 'Romania',
        city: 'Bucharest',
        capacity: 60000,
        specialization: 'Outerwear',
        status: 'Active',
        email: 'bucharest@mangoapparelgroup.com',
        address: 'Otopeni, Bucharest, Romania',
        certifications: 'OEKO-TEX, ISO 9001, BSCI'
      },
      {
        id: 5,
        manufacturerName: 'Mango Apparel Bangladesh',
        facilityCode: 'MNG-DHK-001',
        country: 'Bangladesh',
        city: 'Dhaka',
        capacity: 150000,
        specialization: 'Fast Fashion',
        status: 'Active',
        email: 'dhaka@mangoapparelgroup.com',
        address: 'Savar, Dhaka, Bangladesh',
        certifications: 'WRAP, BSCI, Accord'
      },
      {
        id: 6,
        manufacturerName: 'Mango Apparel Vietnam',
        facilityCode: 'MNG-HCM-001',
        country: 'Vietnam',
        city: 'Ho Chi Minh City',
        capacity: 110000,
        specialization: 'Casual Wear',
        status: 'Active',
        email: 'hcmc@mangoapparelgroup.com',
        address: 'Binh Duong Province, Vietnam',
        certifications: 'WRAP, OEKO-TEX, ISO 14001'
      },
      {
        id: 7,
        manufacturerName: 'Mango Apparel India',
        facilityCode: 'MNG-BLR-001',
        country: 'India',
        city: 'Bangalore',
        capacity: 85000,
        specialization: 'Sustainable Fashion',
        status: 'Active',
        email: 'bangalore@mangoapparelgroup.com',
        address: 'Electronic City, Bangalore, India',
        certifications: 'GOTS, OEKO-TEX, SA8000, WRAP'
      },
      {
        id: 8,
        manufacturerName: 'Mango Apparel Portugal',
        facilityCode: 'MNG-PRT-001',
        country: 'Portugal',
        city: 'Porto',
        capacity: 45000,
        specialization: 'Luxury Apparel',
        status: 'Active',
        email: 'porto@mangoapparelgroup.com',
        address: 'Vila Nova de Gaia, Porto, Portugal',
        certifications: 'OEKO-TEX, GOTS, ISO 9001'
      }
    ];

    // Initialize
    function init() {
      updateMetrics();
      renderTable();
    }

    // Load Mango Apparel Data
    function loadMangoData() {
      manufacturersDatabase = [...mangoApparelData];
      updateMetrics();
      renderTable();
      document.getElementById('importStatus').innerHTML = '<span style="color:var(--green)">‚úÖ Mango Apparel facilities loaded successfully!</span>';
    }

    // Import Excel file
    function importExcelFile() {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];
      
      if (!file) {
        alert('Please select an Excel file to import.');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, {type: 'array'});
          const firstSheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[firstSheetName];
          const jsonData = XLSX.utils.sheet_to_json(worksheet);
          
          // Clear existing data
          manufacturersDatabase = [];
          
          // Process each row
          jsonData.forEach((row, index) => {
            const manufacturer = {
              id: Date.now() + index,
              manufacturerName: row['Manufacturer Name'] || row['Company'] || row['Name'] || '',
              facilityCode: row['Facility Code'] || row['Code'] || `FAC-${String(index + 1).padStart(3, '0')}`,
              country: row['Country'] || row['Location'] || '',
              city: row['City'] || row['Location'] || '',
              capacity: parseInt(row['Capacity'] || row['Production Capacity'] || 0),
              specialization: row['Specialization'] || row['Type'] || 'General Manufacturing',
              status: row['Status'] || 'Active',
              email: row['Email'] || row['Contact'] || '',
              address: row['Address'] || row['Full Address'] || '',
              certifications: row['Certifications'] || row['Certificates'] || ''
            };
            
            if (manufacturer.manufacturerName) {
              manufacturersDatabase.push(manufacturer);
            }
          });
          
          updateMetrics();
          renderTable();
          document.getElementById('importStatus').innerHTML = `<span style="color:var(--green)">‚úÖ Successfully imported ${manufacturersDatabase.length} manufacturers from Excel file!</span>`;
        } catch (error) {
          document.getElementById('importStatus').innerHTML = `<span style="color:var(--red)">‚ùå Error importing file: ${error.message}</span>`;
        }
      };
      
      reader.readAsArrayBuffer(file);
    }

    // Add manufacturer
    function addManufacturer() {
      const manufacturer = {
        id: Date.now(),
        manufacturerName: document.getElementById('manufacturerName').value,
        facilityCode: document.getElementById('facilityCode').value,
        country: document.getElementById('country').value,
        city: document.getElementById('city').value,
        capacity: parseInt(document.getElementById('capacity').value) || 0,
        specialization: document.getElementById('specialization').value,
        status: document.getElementById('status').value,
        email: document.getElementById('email').value,
        address: document.getElementById('address').value,
        certifications: document.getElementById('certifications').value
      };

      if (!manufacturer.manufacturerName || !manufacturer.facilityCode) {
        alert('Please enter Manufacturer Name and Facility Code.');
        return;
      }

      manufacturersDatabase.push(manufacturer);
      updateMetrics();
      renderTable();
      clearForm();
    }

    // Clear form
    function clearForm() {
      document.getElementById('manufacturerName').value = '';
      document.getElementById('facilityCode').value = '';
      document.getElementById('city').value = '';
      document.getElementById('capacity').value = '';
      document.getElementById('email').value = '';
      document.getElementById('address').value = '';
      document.getElementById('certifications').value = '';
    }

    // Clear database
    function clearDatabase() {
      if (confirm('Are you sure you want to clear all manufacturer data?')) {
        manufacturersDatabase = [];
        updateMetrics();
        renderTable();
        document.getElementById('importStatus').innerHTML = '<span style="color:var(--red)">üóëÔ∏è Database cleared</span>';
      }
    }

    // Update metrics
    function updateMetrics() {
      const totalManufacturers = manufacturersDatabase.length;
      const totalCountries = new Set(manufacturersDatabase.map(m => m.country)).size;
      const totalCapacity = manufacturersDatabase.reduce((sum, m) => sum + m.capacity, 0);
      const activeFacilities = manufacturersDatabase.filter(m => m.status === 'Active').length;

      document.getElementById('totalManufacturers').textContent = totalManufacturers;
      document.getElementById('totalCountries').textContent = totalCountries;
      document.getElementById('totalCapacity').textContent = totalCapacity.toLocaleString();
      document.getElementById('activeFacilities').textContent = activeFacilities;
    }

    // Render table
    function renderTable() {
      const tbody = document.getElementById('manufacturersTableBody');
      tbody.innerHTML = manufacturersDatabase.map((manufacturer, index) => {
        const statusClass = manufacturer.status === 'Active' ? 'status-active' : 
                           manufacturer.status === 'Inactive' ? 'status-inactive' : 'status-review';
        
        return `
        <tr>
          <td style="font-weight:600">${index + 1}</td>
          <td style="font-weight:600;color:var(--primary)">${manufacturer.manufacturerName}</td>
          <td style="font-family:monospace">${manufacturer.facilityCode}</td>
          <td>${manufacturer.country}</td>
          <td>${manufacturer.city}</td>
          <td style="text-align:right;font-weight:600">${manufacturer.capacity.toLocaleString()}</td>
          <td>${manufacturer.specialization}</td>
          <td><span class="status-indicator ${statusClass}">${manufacturer.status}</span></td>
          <td>
            <button class="btn" style="padding:6px 12px;font-size:12px" onclick="editManufacturer(${manufacturer.id})">Edit</button>
            <button class="btn danger" style="padding:6px 12px;font-size:12px" onclick="deleteManufacturer(${manufacturer.id})">Delete</button>
          </td>
        </tr>`;
      }).join('');
    }

    // Edit manufacturer
    function editManufacturer(id) {
      const manufacturer = manufacturersDatabase.find(m => m.id === id);
      if (!manufacturer) return;

      document.getElementById('manufacturerName').value = manufacturer.manufacturerName;
      document.getElementById('facilityCode').value = manufacturer.facilityCode;
      document.getElementById('country').value = manufacturer.country;
      document.getElementById('city').value = manufacturer.city;
      document.getElementById('capacity').value = manufacturer.capacity;
      document.getElementById('specialization').value = manufacturer.specialization;
      document.getElementById('status').value = manufacturer.status;
      document.getElementById('email').value = manufacturer.email;
      document.getElementById('address').value = manufacturer.address;
      document.getElementById('certifications').value = manufacturer.certifications;

      // Remove from database for re-adding
      manufacturersDatabase = manufacturersDatabase.filter(m => m.id !== id);
      updateMetrics();
      renderTable();
    }

    // Delete manufacturer
    function deleteManufacturer(id) {
      if (confirm('Are you sure you want to delete this manufacturer?')) {
        manufacturersDatabase = manufacturersDatabase.filter(m => m.id !== id);
        updateMetrics();
        renderTable();
      }
    }

    // Export CSV
    function exportCSV() {
      if (manufacturersDatabase.length === 0) {
        alert('No manufacturers to export!');
        return;
      }

      const headers = [
        'ID', 'Manufacturer Name', 'Facility Code', 'Country', 'City', 
        'Capacity', 'Specialization', 'Status', 'Email', 'Address', 'Certifications'
      ];

      const csvContent = [
        headers.join(','),
        ...manufacturersDatabase.map(manufacturer => [
          manufacturer.id,
          `"${manufacturer.manufacturerName}"`,
          `"${manufacturer.facilityCode}"`,
          `"${manufacturer.country}"`,
          `"${manufacturer.city}"`,
          manufacturer.capacity,
          `"${manufacturer.specialization}"`,
          `"${manufacturer.status}"`,
          `"${manufacturer.email}"`,
          `"${manufacturer.address}"`,
          `"${manufacturer.certifications}"`
        ].join(','))
      ].join('\n');

      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `mango_apparel_facilities_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Initialize on load
    init();
  </script>
</body>
</html>